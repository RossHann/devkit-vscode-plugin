
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="topic">
<meta name="DC.Title" content="Memory Consistency Check">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="en-us_topic_0249523736.html">
<meta name="prodname" content="">
<meta name="version" content="2.3.T21">
<meta name="brand" content="Huawei Kunpeng Porting Advisor">
<meta name="DC.Publisher" content="20201230">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TOPIC_0292866532">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<link rel="stylesheet" type="text/css" href="public_sys-resources/pygments.css">
<title>Memory Consistency Check</title>
</head>
<body style="clear:both; padding-left:10px; padding-top:5px; padding-right:5px; padding-bottom:5px"><a name="EN-US_TOPIC_0292866532"></a><a name="EN-US_TOPIC_0292866532"></a>

<h1 class="topictitle1">Memory Consistency Check</h1>
<div id="body1605600275275"><p id="EN-US_TOPIC_0292866532__p176479281259">The tool checks for memory consistency problems when the source code is ported to the Kunpeng platform and provides suggestions on inserting memory barriers.</p>
<div class="note" id="EN-US_TOPIC_0292866532__note12551324195317"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><ul id="EN-US_TOPIC_0292866532__ul564862314213"><li id="EN-US_TOPIC_0292866532__li16579142784714">The build command to upload the build file in the source package is executed during the task running. Ensure the security and integrity of the uploaded content to avoid affecting the normal operation of the server.</li><li id="EN-US_TOPIC_0292866532__li126488237214">During the memory consistency check, a large number of intermediate files will be generated. If you want to use this function, ensure enough drive space. Generally, about 100 GB drive space is required for every 100,000 lines of code.</li><li id="EN-US_TOPIC_0292866532__li1376754131320">The intermediate file consumes a large amount of memory. Ensure that the available memory or swap space is sufficient. According to experience, about 6 GB memory is required for each 1 MB intermediate file.</li><li id="EN-US_TOPIC_0292866532__li8339164812541">It is recommended the code to be checked not exceed 100,000 lines. The check of a large amount of source code consumes resources.</li><li id="EN-US_TOPIC_0292866532__li8543174205014">If the check fails or the check result indicates that no modification is required, an empty report is generated.</li></ul>
</div></div>
<div class="section" id="EN-US_TOPIC_0292866532__section641662874317"><h4 class="sectiontitle">Prerequisites</h4><div class="p" id="EN-US_TOPIC_0292866532__p12373143711718">You have logged in to the <span id="EN-US_TOPIC_0292866532__ph997750104712">Kunpeng Porting Advisor</span> WebUI.<div class="note" id="EN-US_TOPIC_0292866532__note8799192914203"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_TOPIC_0292866532__p09761715124413"><strong id="EN-US_TOPIC_0292866532__b107982211605">/opt/portadv</strong> is the default installation directory of the tool. The following uses this directory as an example. Replace it with the actual directory.</p>
</div></div>
</div>
</div>
<div class="section" id="EN-US_TOPIC_0292866532__section8124135420196"><h4 class="sectiontitle">Procedure</h4><ol id="EN-US_TOPIC_0292866532__ol166651423121620"><li id="EN-US_TOPIC_0292866532__li10102950192018"><span>In the navigation pane on the left, select <strong id="EN-US_TOPIC_0292866532__b634725822819">Enhanced Functions</strong>.</span><p><p id="EN-US_TOPIC_0292866532__p152451647202216">Select <strong id="EN-US_TOPIC_0292866532__b44831410112915">Memory Consistency</strong> as the check type, as shown in <a href="#EN-US_TOPIC_0292866532__fig145674894612">Figure 1</a>.</p>
<div class="fignone" id="EN-US_TOPIC_0292866532__fig145674894612"><a name="EN-US_TOPIC_0292866532__fig145674894612"></a><a name="fig145674894612"></a><span class="figcap"><b>Figure 1 </b>Memory consistency check</span><br><span><img id="EN-US_TOPIC_0292866532__image09875445313" src="en-us_image_0000001165618647.png" height="467.82750000000004" width="523.6875"></span></div>
</p></li><li id="EN-US_TOPIC_0292866532__li13242218194716"><span>Select a check mode.</span><p><ul id="EN-US_TOPIC_0292866532__ul103211223485"><li id="EN-US_TOPIC_0292866532__li613010229482">For static check, continue with <a href="#EN-US_TOPIC_0292866532__li17722135611159">3</a>.</li><li id="EN-US_TOPIC_0292866532__li1066415111873">For auto repair by the compiler, perform operations as prompted. For details, see <a href="#EN-US_TOPIC_0292866532__section1068110405363">Using the Auto Repair by Compiler</a>.<div class="note" id="EN-US_TOPIC_0292866532__note166415119720"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_TOPIC_0292866532__p1466461119715">The static check features low false positive ratio and a repair rate up to 60%. The auto repair by compiler does not miss any report and features a repair rate of 100%, but the false positive ratio is higher. Higher false positive ratio indicates more impact on performance. The repair rate varies depending on the software, and the impact on performance also varies.</p>
</div></div>
</li></ul>
</p></li><li id="EN-US_TOPIC_0292866532__li17722135611159"><a name="EN-US_TOPIC_0292866532__li17722135611159"></a><a name="li17722135611159"></a><span>Select the upload type.</span><p><ul id="EN-US_TOPIC_0292866532__ul16785315569"><li id="EN-US_TOPIC_0292866532__li179771426370">To upload a source code file, continue with the steps from <a href="#EN-US_TOPIC_0292866532__li3282111212111">4</a> to <a href="#EN-US_TOPIC_0292866532__li1718112352176">7</a>.<div class="note" id="EN-US_TOPIC_0292866532__note192531019562"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_TOPIC_0292866532__p10253150115610">The static check tool uses the Clang compilation tool to build user projects and generate BC files as the input to the static check tool. Ensure that the uploaded code can be compiled using the Clang compilation tool.</p>
</div></div>
</li><li id="EN-US_TOPIC_0292866532__li619985055618">To upload a BC file, continue with the steps from <a href="#EN-US_TOPIC_0292866532__li04715371819">8</a> to <a href="#EN-US_TOPIC_0292866532__li157631266224">9</a>.</li></ul>
</p></li><li id="EN-US_TOPIC_0292866532__li3282111212111"><a name="EN-US_TOPIC_0292866532__li3282111212111"></a><a name="li3282111212111"></a><span>Set <strong id="EN-US_TOPIC_0292866532__b24951736172117">Source Code File Path</strong>. You can use either of the following methods to upload the source code file:</span><p><ul id="EN-US_TOPIC_0292866532__ul2028231241115"><li id="EN-US_TOPIC_0292866532__li928231210113">Click <strong id="EN-US_TOPIC_0292866532__b6983175182111">Upload</strong> to upload the package or folder. The package will be automatically decompressed during the upload process.<div class="note" id="EN-US_TOPIC_0292866532__note192828122114"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><ul id="EN-US_TOPIC_0292866532__ul13282181261110"><li id="EN-US_TOPIC_0292866532__li202821912101117">Only <strong id="EN-US_TOPIC_0292866532__b1112620562174">tar</strong>, <strong id="EN-US_TOPIC_0292866532__b10127956111715">tar.bz</strong>, <strong id="EN-US_TOPIC_0292866532__b612718562170">tar.bz2</strong>, <strong id="EN-US_TOPIC_0292866532__b512785611711">tar.gz</strong>, <strong id="EN-US_TOPIC_0292866532__b712795616179">tar.xz</strong>, <strong id="EN-US_TOPIC_0292866532__b912712564174">tbz</strong>, <strong id="EN-US_TOPIC_0292866532__b141281456131718">tbz2</strong>, <strong id="EN-US_TOPIC_0292866532__b101281156131719">tgz</strong>, <strong id="EN-US_TOPIC_0292866532__b181282567175">txz</strong>, and <strong id="EN-US_TOPIC_0292866532__b51281056181720">zip</strong> packages can be uploaded. Only one package can be uploaded at a time. The size of the source code package should be less than or equal to 1 GB. The decompressed file size should be less than or equal to half of the remaining drive space.</li><li id="EN-US_TOPIC_0292866532__li1228261241114">Only one folder can be uploaded at a time. The size of the folder must be less than or equal to half of the remaining drive space.</li><li id="EN-US_TOPIC_0292866532__li12282191241119">Internet Explorer is incompatible with the folder upload function. You need to use other browsers, such as Google Chrome and Microsoft Edge, to upload folders.</li></ul>
</div></div>
</li><li id="EN-US_TOPIC_0292866532__li132825125114">Manually upload the source code file to the specified path (for example, <strong id="EN-US_TOPIC_0292866532__b14981102782">/opt/portadv/portadmin/weakconsistency/</strong>) on the server. Grant the read, write, and execute permissions to the <strong id="EN-US_TOPIC_0292866532__b8987112489">porting</strong> user. Then, click the text box to select the source code file path from the drop-down list. You can also manually enter the source code file path.</li></ul>
</p></li><li id="EN-US_TOPIC_0292866532__li144137423115"><span>Enter the compile command and click <strong id="EN-US_TOPIC_0292866532__b5475193018107">Next</strong>.</span><p><p id="EN-US_TOPIC_0292866532__p164131742181111">The BC file is generated after the compile command is parsed.</p>
<div class="note" id="EN-US_TOPIC_0292866532__note441312422114"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><ul id="EN-US_TOPIC_0292866532__ul4925185214129"><li id="EN-US_TOPIC_0292866532__li19251952121219">Compile commands include <strong id="EN-US_TOPIC_0292866532__b64622395230">make</strong>, <strong id="EN-US_TOPIC_0292866532__b54571042182320">cmake</strong>, <strong id="EN-US_TOPIC_0292866532__b1392064412234">configure</strong>, <strong id="EN-US_TOPIC_0292866532__b18969124717236">shell</strong>, and shell scripts. The <strong id="EN-US_TOPIC_0292866532__b134946568239">make install</strong> command is not supported.</li><li id="EN-US_TOPIC_0292866532__li16925145221220">The build command or build script cannot be used to create or modify directories or files that are not in the user space (<strong id="EN-US_TOPIC_0292866532__b6929153942618">/opt/portadv/</strong><em id="EN-US_TOPIC_0292866532__i6124027192617">user name</em>/).</li><li id="EN-US_TOPIC_0292866532__li1092585261218">If a BC file fails to be generated during the check, you can <a href="#EN-US_TOPIC_0292866532__section65321243105014">generate a BC file</a>. Then perform steps from <a href="#EN-US_TOPIC_0292866532__li04715371819">8</a> to <a href="#EN-US_TOPIC_0292866532__li157631266224">9</a> and select <span class="uicontrol" id="EN-US_TOPIC_0292866532__uicontrol1324274114265"><b>BC File Upload</b></span> to directly analyze the BC file and perform the memory consistency check.</li></ul>
</div></div>
</p></li><li id="EN-US_TOPIC_0292866532__li1113733191416"><span>Select the generated BC file and click <span class="uicontrol" id="EN-US_TOPIC_0292866532__uicontrol413033111415"><b>Check</b></span> to start the memory consistency check.</span><p><div class="fignone" id="EN-US_TOPIC_0292866532__fig131927122315"><span class="figcap"><b>Figure 2 </b>Selecting BC File</span><br><span><img id="EN-US_TOPIC_0292866532__image53527142312" src="en-us_image_0000001177162683.png" height="385.035" width="523.6875"></span></div>
<div class="note" id="EN-US_TOPIC_0292866532__note176334882312"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><ul id="EN-US_TOPIC_0292866532__ul1476093511513"><li id="EN-US_TOPIC_0292866532__li11760203517514">If the source code is too large, you can download the generated BC file (multiple BC files can be downloaded at a time). Then, perform <a href="#EN-US_TOPIC_0292866532__li04715371819">8</a> to <a href="#EN-US_TOPIC_0292866532__li157631266224">9</a> to upload and analyze the BC file and check the memory consistency.</li><li id="EN-US_TOPIC_0292866532__li67606351250">If you need to generate the configuration file of the compiler tool, select <strong id="EN-US_TOPIC_0292866532__b105591022104014">Generating compiler tool configuration files</strong>.</li></ul>
</div></div>
<p id="EN-US_TOPIC_0292866532__p1066772214219">After the check is complete, click <strong id="EN-US_TOPIC_0292866532__b199831300183">View Report</strong>. The <span class="wintitle" id="EN-US_TOPIC_0292866532__wintitle6984150101813"><b>Check Report</b></span> page is displayed, as shown in <a href="#EN-US_TOPIC_0292866532__fig156671922152114">Figure 3</a>.</p>
<div class="p" id="EN-US_TOPIC_0292866532__p81862201255"><div class="fignone" id="EN-US_TOPIC_0292866532__fig156671922152114"><a name="EN-US_TOPIC_0292866532__fig156671922152114"></a><a name="fig156671922152114"></a><span class="figcap"><b>Figure 3 </b>Memory consistency check report</span><br><span><img id="EN-US_TOPIC_0292866532__image3667202219215" src="en-us_image_0000001118056752.png" height="165.585" width="523.6875"></span></div>
</div>
<div class="note" id="EN-US_TOPIC_0292866532__note168010232276"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><ul id="EN-US_TOPIC_0292866532__ul1926142316113"><li id="EN-US_TOPIC_0292866532__li22611823101117">You can click <span><img id="EN-US_TOPIC_0292866532__image13611215133210" src="en-us_image_0000001177164809.png"></span> to sort the source code files to be modified by path or number of recommended modifications.</li><li id="EN-US_TOPIC_0292866532__li1426112232116">If <strong id="EN-US_TOPIC_0292866532__b148751133104414">Generating compiler tool configuration files</strong> is selected, you can click <strong id="EN-US_TOPIC_0292866532__b76128124512">Download compiler configuration files</strong> to download the file. You can also hover the mouse pointer over the <span><img id="EN-US_TOPIC_0292866532__image16363132113417" src="en-us_image_0000001133809420.png" width="14.971544000000002" height="15.570443000000001"></span> of the target report in the <strong id="EN-US_TOPIC_0292866532__b16662101554617">Historical Reports</strong> area and select <strong id="EN-US_TOPIC_0292866532__b1338246144719">Download compiler configuration files</strong>.</li><li id="EN-US_TOPIC_0292866532__li1169412116126">If the system displays a message indicating that the compiler configuration file is not the latest, click <strong id="EN-US_TOPIC_0292866532__b317134164814">Go</strong> to download the file from the latest report. If the system displays a message indicating that the latest report does not contain the compiler configuration file, perform operations as prompted.</li></ul>
</div></div>
</p></li><li id="EN-US_TOPIC_0292866532__li1718112352176"><a name="EN-US_TOPIC_0292866532__li1718112352176"></a><a name="li1718112352176"></a><span>Click <span class="uicontrol" id="EN-US_TOPIC_0292866532__uicontrol135401916124011"><b>View Suggested Source Code</b></span> in the <strong id="EN-US_TOPIC_0292866532__b8540716174013">Operation</strong> column. The page shown in <a href="#EN-US_TOPIC_0292866532__fig3171049175215">Figure 4</a> is displayed.</span><p><div class="notice" id="EN-US_TOPIC_0292866532__note338144885110"><span class="noticetitle"><img src="public_sys-resources/notice_3.0-en-us.png"> </span><div class="noticebody"><p id="EN-US_TOPIC_0292866532__en-us_topic_0189800508_p461752353216">When editing the original code, save the modification in time. Otherwise, the modification may be lost due to session timeout.</p>
</div></div>
<div class="fignone" id="EN-US_TOPIC_0292866532__fig3171049175215"><a name="EN-US_TOPIC_0292866532__fig3171049175215"></a><a name="fig3171049175215"></a><span class="figcap"><b>Figure 4 </b>Source code change suggestions</span><br><span><img id="EN-US_TOPIC_0292866532__image6171749135217" src="en-us_image_0000001118216664.png" height="196.50750000000002" width="523.6875"></span></div>
<div class="note" id="EN-US_TOPIC_0292866532__note517114955215"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><ul id="EN-US_TOPIC_0292866532__ul1317184965219"><li id="EN-US_TOPIC_0292866532__li1217194911527">You can move the cursor to the code with a red wavy line and click <strong id="EN-US_TOPIC_0292866532__b142154235596">Quick Fix</strong> in the floating message to apply the change automatically. You can also select <strong id="EN-US_TOPIC_0292866532__b1921512315914">Apply modifications of this class in this file</strong> to modify the same type of code in batches. You can modify the source code. After the modification, click <strong id="EN-US_TOPIC_0292866532__b189381025195913">Save</strong>, <strong id="EN-US_TOPIC_0292866532__b12938172595917">Undo</strong>, or <strong id="EN-US_TOPIC_0292866532__b14938025105918">Cancel</strong> in the upper right corner as required.</li><li id="EN-US_TOPIC_0292866532__li12836163110617">After quick fix, the source code may fail to be compiled. <a href="en-us_topic_0000001202657509.html">Failed to Compile Source Code After a Quick Fix Upon a Memory Consistency Check</a> in FAQs describes a commonly seen scenario.</li><li id="EN-US_TOPIC_0292866532__li7172495526">To download a source code file, select the file on the left and click the download icon.</li><li id="EN-US_TOPIC_0292866532__li111764955215">You can click the arrow keys in the upper right corner of <strong id="EN-US_TOPIC_0292866532__b6214172920592">Original Source Code</strong> to view the code.</li><li id="EN-US_TOPIC_0292866532__li51754975211">The tool supports concurrent running of multiple memory consistency checks.</li><li id="EN-US_TOPIC_0292866532__li1817149175210">To cancel a task, click <strong id="EN-US_TOPIC_0292866532__b62958194518">Close</strong> during the analysis process.</li></ul>
</div></div>
</p></li><li id="EN-US_TOPIC_0292866532__li04715371819"><a name="EN-US_TOPIC_0292866532__li04715371819"></a><a name="li04715371819"></a><span>Set the <strong id="EN-US_TOPIC_0292866532__b1156301319452">BC File Path</strong>. You can use either of the following methods to upload the BC file:</span><p><ul id="EN-US_TOPIC_0292866532__ul9826339699"><li id="EN-US_TOPIC_0292866532__li5826439294">Click <strong id="EN-US_TOPIC_0292866532__b1125797087">Upload</strong> to upload the BC file.</li><li id="EN-US_TOPIC_0292866532__li1682733919916">Manually upload the BC file to the specified path (for example, <strong id="EN-US_TOPIC_0292866532__b10436458467">/opt/portadv/portadmin/weakconsistency_bc/</strong>) on the server. Then, click the text box to select the BC file from the drop-down list box. You can also manually enter the BC file name.</li></ul>
</p></li><li id="EN-US_TOPIC_0292866532__li157631266224"><a name="EN-US_TOPIC_0292866532__li157631266224"></a><a name="li157631266224"></a><span>Click <strong id="EN-US_TOPIC_0292866532__b6739143165412">Check</strong> to start the memory consistency check.</span><p><div class="p" id="EN-US_TOPIC_0292866532__p149361015142313">After the check is complete, click <strong id="EN-US_TOPIC_0292866532__b136144118184">View Report</strong>. The <span class="wintitle" id="EN-US_TOPIC_0292866532__wintitle206158111182"><b>check report</b></span> page is displayed, as shown in <a href="#EN-US_TOPIC_0292866532__fig225241115012">Figure 5</a>.<div class="fignone" id="EN-US_TOPIC_0292866532__fig225241115012"><a name="EN-US_TOPIC_0292866532__fig225241115012"></a><a name="fig225241115012"></a><span class="figcap"><b>Figure 5 </b>Memory consistency check report</span><br><span><img id="EN-US_TOPIC_0292866532__image8838155681418" src="en-us_image_0000001118216678.png" height="165.585" width="523.6875"></span></div>
</div>
<p id="EN-US_TOPIC_0292866532__p2647185555011">The BC file check report displays the number of recommended modification points and the specific location of the code to be modified. You can check and modify the code based on the check report.</p>
</p></li></ol>
</div>
<div class="section" id="EN-US_TOPIC_0292866532__section1068110405363"><a name="EN-US_TOPIC_0292866532__section1068110405363"></a><a name="section1068110405363"></a><h4 class="sectiontitle">Using the Auto Repair by Compiler</h4><p id="EN-US_TOPIC_0292866532__p8141185923815">The tool supports the following OSs and GCC versions:</p>

<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" id="EN-US_TOPIC_0292866532__table1221802921613" frame="border" border="1" rules="all"><caption><b>Table 1 </b>Supported OSs and GCC Versions</caption><colgroup><col style="width:16.18%"><col style="width:83.82%"></colgroup><thead align="left"><tr id="EN-US_TOPIC_0292866532__row18219229191611"><th align="left" class="cellrowborder" valign="top" width="16.18%" id="mcps1.3.5.3.2.3.1.1"><p id="EN-US_TOPIC_0292866532__p1521918299161">OS</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="83.82%" id="mcps1.3.5.3.2.3.1.2"><p id="EN-US_TOPIC_0292866532__p18219122920165">GCC Version</p>
</th>
</tr>
</thead>
<tbody><tr id="EN-US_TOPIC_0292866532__row13667153117231"><td class="cellrowborder" valign="top" width="16.18%" headers="mcps1.3.5.3.2.3.1.1 "><p id="EN-US_TOPIC_0292866532__p14667123142310">BC-Linux 7.6/7.7</p>
</td>
<td class="cellrowborder" valign="top" width="83.82%" headers="mcps1.3.5.3.2.3.1.2 "><p id="EN-US_TOPIC_0292866532__p2667153112314">GCC 4.8.5/4.9.3/5.1.0/5.2.0/5.3.0/5.4.0/5.5.0/6.1.0/6.2.0/6.3.0/6.4.0/6.5.0/7.1.0/7.2.0/7.3.0/7.4.0/8.1.0/8.2.0/8.3.0/9.1.0/9.2.0/9.3.0</p>
</td>
</tr>
<tr id="EN-US_TOPIC_0292866532__row621962914166"><td class="cellrowborder" valign="top" width="16.18%" headers="mcps1.3.5.3.2.3.1.1 "><p id="EN-US_TOPIC_0292866532__p8219729131619">CentOS 7.4/7.5/7.6/7.7</p>
</td>
<td class="cellrowborder" valign="top" width="83.82%" headers="mcps1.3.5.3.2.3.1.2 "><p id="EN-US_TOPIC_0292866532__p1957045416164">GCC 4.8.5/4.9.3/5.1.0/5.2.0/5.3.0/5.4.0/5.5.0/6.1.0/6.2.0/6.3.0/6.4.0/6.5.0/7.1.0/7.2.0/7.3.0/7.4.0/8.1.0/8.2.0/8.3.0/9.1.0/9.2.0/9.3.0</p>
</td>
</tr>
<tr id="EN-US_TOPIC_0292866532__row1721912961618"><td class="cellrowborder" valign="top" width="16.18%" headers="mcps1.3.5.3.2.3.1.1 "><p id="EN-US_TOPIC_0292866532__p1521952911617">CentOS 8.0</p>
</td>
<td class="cellrowborder" valign="top" width="83.82%" headers="mcps1.3.5.3.2.3.1.2 "><p id="EN-US_TOPIC_0292866532__p6219192991612">GCC 8.2.0/8.3.0/9.1.0/9.2.0/9.3.0</p>
</td>
</tr>
<tr id="EN-US_TOPIC_0292866532__row1221942921614"><td class="cellrowborder" valign="top" width="16.18%" headers="mcps1.3.5.3.2.3.1.1 "><p id="EN-US_TOPIC_0292866532__p1321942915160">CentOS 8.1/8.2</p>
</td>
<td class="cellrowborder" valign="top" width="83.82%" headers="mcps1.3.5.3.2.3.1.2 "><p id="EN-US_TOPIC_0292866532__p122191029151618">GCC 8.3.0/9.1.0/9.2.0/9.3.0</p>
</td>
</tr>
<tr id="EN-US_TOPIC_0292866532__row1021982912163"><td class="cellrowborder" valign="top" width="16.18%" headers="mcps1.3.5.3.2.3.1.1 "><p id="EN-US_TOPIC_0292866532__p2021911297166">Debian 10</p>
</td>
<td class="cellrowborder" valign="top" width="83.82%" headers="mcps1.3.5.3.2.3.1.2 "><p id="EN-US_TOPIC_0292866532__p152191729111619">GCC 8.3.0/9.1.0/9.2.0/9.3.0</p>
</td>
</tr>
<tr id="EN-US_TOPIC_0292866532__row3882935141914"><td class="cellrowborder" valign="top" width="16.18%" headers="mcps1.3.5.3.2.3.1.1 "><p id="EN-US_TOPIC_0292866532__p1882143516191">Deepin 15.2</p>
</td>
<td class="cellrowborder" valign="top" width="83.82%" headers="mcps1.3.5.3.2.3.1.2 "><p id="EN-US_TOPIC_0292866532__p138821935161917">GCC 6.3.0/6.4.0/6.5.0/7.1.0/7.2.0/7.3.0/7.4.0/8.1.0/8.2.0/8.3.0/9.1.0/9.2.0/9.3.0</p>
</td>
</tr>
<tr id="EN-US_TOPIC_0292866532__row361647202615"><td class="cellrowborder" valign="top" width="16.18%" headers="mcps1.3.5.3.2.3.1.1 "><p id="EN-US_TOPIC_0292866532__p127144742611">iSoft 5.1</p>
</td>
<td class="cellrowborder" valign="top" width="83.82%" headers="mcps1.3.5.3.2.3.1.2 "><p id="EN-US_TOPIC_0292866532__p13784716266">GCC 7.3.0/7.4.0/8.1.0/8.2.0/8.3.0/9.1.0/9.2.0/9.3.0</p>
</td>
</tr>
<tr id="EN-US_TOPIC_0292866532__row10219629181619"><td class="cellrowborder" valign="top" width="16.18%" headers="mcps1.3.5.3.2.3.1.1 "><p id="EN-US_TOPIC_0292866532__p4219729121611">Kylin V10 SP1</p>
</td>
<td class="cellrowborder" valign="top" width="83.82%" headers="mcps1.3.5.3.2.3.1.2 "><p id="EN-US_TOPIC_0292866532__p7219122981611">GCC 7.3.0/7.4.0/8.1.0/8.2.0/8.3.0/9.1.0/9.2.0/9.3.0</p>
</td>
</tr>
<tr id="EN-US_TOPIC_0292866532__row132191229111619"><td class="cellrowborder" valign="top" width="16.18%" headers="mcps1.3.5.3.2.3.1.1 "><p id="EN-US_TOPIC_0292866532__p142191129111612">LinxOS 6.0.90</p>
</td>
<td class="cellrowborder" valign="top" width="83.82%" headers="mcps1.3.5.3.2.3.1.2 "><p id="EN-US_TOPIC_0292866532__p52199292161">GCC 6.3.0/6.4.0/6.5.0/7.1.0/7.2.0/7.3.0/7.4.0/8.1.0/8.2.0/8.3.0/9.1.0/9.2.0/9.3.0</p>
</td>
</tr>
<tr id="EN-US_TOPIC_0292866532__row02191729171617"><td class="cellrowborder" valign="top" width="16.18%" headers="mcps1.3.5.3.2.3.1.1 "><p id="EN-US_TOPIC_0292866532__p172191329101610">NeoKylin V7U6</p>
</td>
<td class="cellrowborder" valign="top" width="83.82%" headers="mcps1.3.5.3.2.3.1.2 "><p id="EN-US_TOPIC_0292866532__p6219122916162">GCC 4.8.5/4.9.3/5.1.0/5.2.0/5.3.0/5.4.0/5.5.0/6.1.0/6.2.0/6.3.0/6.4.0/6.5.0/7.1.0/7.2.0/7.3.0/7.4.0/8.1.0/8.2.0/8.3.0/9.1.0/9.2.0/9.3.0</p>
</td>
</tr>
<tr id="EN-US_TOPIC_0292866532__row54591376152"><td class="cellrowborder" valign="top" width="16.18%" headers="mcps1.3.5.3.2.3.1.1 "><p id="EN-US_TOPIC_0292866532__p164761341151514">openEuler 20.03</p>
</td>
<td class="cellrowborder" valign="top" width="83.82%" headers="mcps1.3.5.3.2.3.1.2 "><p id="EN-US_TOPIC_0292866532__p2047610410156">GCC 7.3.0/7.4.0/8.1.0/8.2.0/8.3.0/9.1.0/9.2.0/9.3.0</p>
</td>
</tr>
<tr id="EN-US_TOPIC_0292866532__row20694171511199"><td class="cellrowborder" valign="top" width="16.18%" headers="mcps1.3.5.3.2.3.1.1 "><p id="EN-US_TOPIC_0292866532__p469471513197">openEuler 20.03 LTS SP1</p>
</td>
<td class="cellrowborder" valign="top" width="83.82%" headers="mcps1.3.5.3.2.3.1.2 "><p id="EN-US_TOPIC_0292866532__p156941415111918">GCC 7.3.0/7.4.0/8.1.0/8.2.0/8.3.0/9.1.0/9.2.0/9.3.0</p>
</td>
</tr>
<tr id="EN-US_TOPIC_0292866532__row1142220129123"><td class="cellrowborder" valign="top" width="16.18%" headers="mcps1.3.5.3.2.3.1.1 "><p id="EN-US_TOPIC_0292866532__p642261231217">openEuler 20.03 LTS SP2</p>
</td>
<td class="cellrowborder" valign="top" width="83.82%" headers="mcps1.3.5.3.2.3.1.2 "><p id="EN-US_TOPIC_0292866532__p342261210121">GCC 7.3.0/7.4.0/8.1.0/8.2.0/8.3.0/9.1.0/9.2.0/9.3.0</p>
</td>
</tr>
<tr id="EN-US_TOPIC_0292866532__row1397791452016"><td class="cellrowborder" valign="top" width="16.18%" headers="mcps1.3.5.3.2.3.1.1 "><p id="EN-US_TOPIC_0292866532__p99777143204">SLES 15.1</p>
</td>
<td class="cellrowborder" valign="top" width="83.82%" headers="mcps1.3.5.3.2.3.1.2 "><p id="EN-US_TOPIC_0292866532__p12977141482016">GCC 7.4.0/8.1.0/8.2.0/8.3.0/9.1.0/9.2.0/9.3.0</p>
</td>
</tr>
<tr id="EN-US_TOPIC_0292866532__row8834113952012"><td class="cellrowborder" valign="top" width="16.18%" headers="mcps1.3.5.3.2.3.1.1 "><p id="EN-US_TOPIC_0292866532__p1783433942017">Ubuntu 18.04.x</p>
</td>
<td class="cellrowborder" valign="top" width="83.82%" headers="mcps1.3.5.3.2.3.1.2 "><p id="EN-US_TOPIC_0292866532__p1783423920207">GCC 7.3.0/7.4.0/8.1.0/8.2.0/8.3.0/9.1.0/9.2.0/9.3.0</p>
</td>
</tr>
<tr id="EN-US_TOPIC_0292866532__row16898348162016"><td class="cellrowborder" valign="top" width="16.18%" headers="mcps1.3.5.3.2.3.1.1 "><p id="EN-US_TOPIC_0292866532__p6898184811207">Ubuntu 20.04.x</p>
</td>
<td class="cellrowborder" valign="top" width="83.82%" headers="mcps1.3.5.3.2.3.1.2 "><p id="EN-US_TOPIC_0292866532__p895310545202">GCC 9.3.0</p>
</td>
</tr>
<tr id="EN-US_TOPIC_0292866532__row7482155819209"><td class="cellrowborder" valign="top" width="16.18%" headers="mcps1.3.5.3.2.3.1.1 "><p id="EN-US_TOPIC_0292866532__p16482175822014">UOS 20 SP1</p>
</td>
<td class="cellrowborder" valign="top" width="83.82%" headers="mcps1.3.5.3.2.3.1.2 "><p id="EN-US_TOPIC_0292866532__p17482115812207">GCC 8.3.0/9.1.0/9.2.0/9.3.0</p>
</td>
</tr>
<tr id="EN-US_TOPIC_0292866532__row641210253252"><td class="cellrowborder" valign="top" width="16.18%" headers="mcps1.3.5.3.2.3.1.1 "><p id="EN-US_TOPIC_0292866532__p34131525202514">uosEuler 20</p>
</td>
<td class="cellrowborder" valign="top" width="83.82%" headers="mcps1.3.5.3.2.3.1.2 "><p id="EN-US_TOPIC_0292866532__p7413172522520">GCC 7.3.0/7.4.0/8.1.0/8.2.0/8.3.0/9.1.0/9.2.0/9.3.0</p>
</td>
</tr>
</tbody>
</table>
</div>
<div class="note" id="EN-US_TOPIC_0292866532__note14334141718282"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><ul id="EN-US_TOPIC_0292866532__ul8385192118617"><li id="EN-US_TOPIC_0292866532__li1338519215618">The GCC versions listed are the default GCC versions supported by the OSs. If the GCC version of the server has been upgraded, compatibility issues may occur.</li><li id="EN-US_TOPIC_0292866532__li173852215619">The supported GCC versions are official GCC branches. Do not use the GCC for openEuler versions.</li></ul>
</div></div>
<p id="EN-US_TOPIC_0292866532__p167230532425">Before using this function, you need to configure the environment as follows:</p>
<ol id="EN-US_TOPIC_0292866532__ol7452105617278"><li id="EN-US_TOPIC_0292866532__li144531356152712"><span>Download software packages.</span><p><ul id="EN-US_TOPIC_0292866532__ul31517714249"><li id="EN-US_TOPIC_0292866532__li739992633115">GCC source code: <a href="https://gcc.gnu.org/" target="_blank" rel="noopener noreferrer">https://gcc.gnu.org/</a> (Download the source code of the corresponding version from the official GCC website.)</li><li id="EN-US_TOPIC_0292866532__li91511070245">GCC repair tool patch: <a href="https://github.com/kunpengcompute/devkitdriver/tree/main/gccchecker" target="_blank" rel="noopener noreferrer">https://github.com/kunpengcompute/devkitdriver/tree/main/gccchecker</a> (for Debian and RHEL OSs)</li><li id="EN-US_TOPIC_0292866532__li11511170244">Memory consistency repair component: Obtain <strong id="EN-US_TOPIC_0292866532__b44963597588">/tools/weakconsistency/gccchecker/gcctool.tar.gz</strong> in the tool installation directory.</li></ul>
</p></li><li id="EN-US_TOPIC_0292866532__li1645335611276"><span>Install the memory consistency repair component.</span><p><ol type="a" id="EN-US_TOPIC_0292866532__ol152481412133319"><li id="EN-US_TOPIC_0292866532__li745317569278">Decompress the installation package.<div class="codecoloring" codetype="Bash" id="EN-US_TOPIC_0292866532__screen0602135042014"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>tar xf gcctool.tar.gz
</pre></div>
</td></tr></table></div>
<p id="EN-US_TOPIC_0292866532__p7346162262611">Check that the following files exist in the <span class="filepath" id="EN-US_TOPIC_0292866532__filepath11745932462"><b>gcctool/bin</b></span> directory:</p>
<p id="EN-US_TOPIC_0292866532__p92531119103315"><strong id="EN-US_TOPIC_0292866532__b1059848191918">gcctool</strong>, <strong id="EN-US_TOPIC_0292866532__b0599108121911">gcctool-bin</strong>, and <strong id="EN-US_TOPIC_0292866532__b159918814192">libstdc++.so.6</strong></p>
</li></ol><ol type="a" start="2" id="EN-US_TOPIC_0292866532__ol136891030133319"><li id="EN-US_TOPIC_0292866532__li74531556132720">Configure environment variables.<p id="EN-US_TOPIC_0292866532__p8563133814493"><a name="EN-US_TOPIC_0292866532__li74531556132720"></a><a name="li74531556132720"></a>Place gcctool in the installation directory and configure environment variables.</p>
<div class="codecoloring" codetype="Bash" id="EN-US_TOPIC_0292866532__screen458012512211"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span>/path/to/gcctool/bin:<span class="nv">$PATH</span>
</pre></div>
</td></tr></table></div>
</li></ol>
</p></li><li id="EN-US_TOPIC_0292866532__li184533569275"><span>Apply the GCC patch.</span><p><div class="note" id="EN-US_TOPIC_0292866532__note1139610359504"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_TOPIC_0292866532__p76291421135118">If "'patch' command not found" is displayed, run the following command to install the patch:</p>
<p id="EN-US_TOPIC_0292866532__p1875912512223"><strong id="EN-US_TOPIC_0292866532__b7289202213489">Debian OSs</strong>:</p>
<div class="codecoloring" codetype="Bash" id="EN-US_TOPIC_0292866532__screen049411574223"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>apt install patch
</pre></div>
</td></tr></table></div>
<p id="EN-US_TOPIC_0292866532__p565110472319"><strong id="EN-US_TOPIC_0292866532__b11601553144416">RHEL OSs</strong>:</p>
<div class="codecoloring" codetype="Bash" id="EN-US_TOPIC_0292866532__screen122022010122320"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>yum install patch
</pre></div>
</td></tr></table></div>
</div></div>
<div class="codecoloring" codetype="Bash" id="EN-US_TOPIC_0292866532__screen10263127172317"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">cd</span> /gcc/source/root/dir
patch -p1 &lt; /path/to/gcc/patch/file
</pre></div>
</td></tr></table></div>
</p></li><li id="EN-US_TOPIC_0292866532__li16453155682714"><span>Compile GCC.</span><p><p id="EN-US_TOPIC_0292866532__p181145292012">For details about how to compile the GCC source code, see the official GCC documents. The patch does not affect the GCC dependency components and the compilation process. If you have any GCC compilation problem, see <a href="https://gcc.gnu.org/install/index.html" target="_blank" rel="noopener noreferrer">https://gcc.gnu.org/install/index.html</a>.</p>
</p></li></ol>
<p id="EN-US_TOPIC_0292866532__p6907104044519">After the environment is set up, perform the following steps to use the tool:</p>
<ol id="EN-US_TOPIC_0292866532__ol26754113214"><li id="EN-US_TOPIC_0292866532__li1967341828"><span>Set the optimization level of the memory consistency repair component.</span><p><div class="codecoloring" codetype="Bash" id="EN-US_TOPIC_0292866532__screen03451510182411"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">HW_DEBUG</span><span class="o">=[</span> <span class="m">0</span> <span class="p">|</span> <span class="m">1</span> <span class="p">|</span> <span class="m">2</span> <span class="o">]</span>
</pre></div>
</td></tr></table></div>
<p id="EN-US_TOPIC_0292866532__p89619167524">The compiling component supports configuration of the optimization level through environment variables. If the environment variables are not set, the repair component does not take effect.</p>
<ul id="EN-US_TOPIC_0292866532__ul44613456164"><li id="EN-US_TOPIC_0292866532__li1046124511168"><strong id="EN-US_TOPIC_0292866532__b1874410318538">0</strong>: Do not use any optimization policy. This setting results in the largest performance loss.</li><li id="EN-US_TOPIC_0292866532__li1146194512165"><strong id="EN-US_TOPIC_0292866532__b6475141235416">1</strong>: Use the most secure repair policy. This setting compromises the performance a lot.</li><li id="EN-US_TOPIC_0292866532__li177271340101014"><strong id="EN-US_TOPIC_0292866532__b174601231155511">2</strong>: Use component optimization rules. This setting helps minimize the performance loss.</li></ul>
</p></li><li id="EN-US_TOPIC_0292866532__li15261349151013"><span>(Optional) Define the range of source code that can be automatically fixed.</span><p><ol type="a" id="EN-US_TOPIC_0292866532__ol1214755817237"><li id="EN-US_TOPIC_0292866532__li1814705872310">You can customize the source code repair range by file or function. After the allowlist is configured, the repair component repairs only the content in the list. The following is an allowlist format:<ul id="EN-US_TOPIC_0292866532__ul15942619237"><li id="EN-US_TOPIC_0292866532__li8941166237">The file list starts with <strong id="EN-US_TOPIC_0292866532__b139701945183316">files:</strong>. Each file occupies one line.</li><li id="EN-US_TOPIC_0292866532__li1894196102315">The file path must be an absolute path.</li><li id="EN-US_TOPIC_0292866532__li149413619236">Only C, C++, and Fortran files are supported. Pure assembly files are not supported.</li><li id="EN-US_TOPIC_0292866532__li39446142314">The function list starts with <strong id="EN-US_TOPIC_0292866532__b10768121516351">functions:</strong>. Each function occupies one line.</li><li id="EN-US_TOPIC_0292866532__li109412642314">C/C++ common functions are supported. Templates or functions with the <strong id="EN-US_TOPIC_0292866532__b614971163911">abi_tag</strong> attribute are not supported.</li></ul>
<p id="EN-US_TOPIC_0292866532__p3486129182912">Allowlist example:</p>
<div class="codecoloring" codetype="Bash" id="EN-US_TOPIC_0292866532__screen115823916307"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span>files:
  /path/to/file/a
  /path/to/./file/b
  /path/to/../file/c
  /path/to/file/d
functions:
  func_a
  func_b<span class="o">()</span>
  func_c<span class="o">(</span>int xxx<span class="o">)</span>
  int func_d<span class="o">()</span>
  classA::func_e
  ns::classB::func_f<span class="o">()</span>
  std::string nsA::nsB::classC::func_g<span class="o">(</span>int xxx<span class="o">)</span>
</pre></div>
</td></tr></table></div>
</li><li id="EN-US_TOPIC_0292866532__li34361526192417">The repair component obtains the path of the allowlist.<p id="EN-US_TOPIC_0292866532__p1283512481279"><a name="EN-US_TOPIC_0292866532__li34361526192417"></a><a name="li34361526192417"></a>You can set environment variables to specify the path of the allowlist. The path is not specified by default.</p>
<p id="EN-US_TOPIC_0292866532__p1116104372415"><span class="uicontrol" id="EN-US_TOPIC_0292866532__uicontrol177724618274"><b>export AUTOFIXLIST=/path/to/allowlist</b></span></p>
</li></ol>
</p></li><li id="EN-US_TOPIC_0292866532__li1067641229"><span>Compile software.</span><p><p id="EN-US_TOPIC_0292866532__p31481243183319">The compilation process remains unchanged. (Remove the <strong id="EN-US_TOPIC_0292866532__b108083181912">-pipe</strong> compilation option if it is used in the original compilation. This does not affect the original compilation result.)</p>
</p></li></ol>
</div>
<div class="section" id="EN-US_TOPIC_0292866532__section65321243105014"><a name="EN-US_TOPIC_0292866532__section65321243105014"></a><a name="section65321243105014"></a><h4 class="sectiontitle">Generating a BC File</h4><p id="EN-US_TOPIC_0292866532__p162877526507">Bitcode (BC) file is an intermediate file (IR) generated by compiling the source code using LLVM. The BC file is the binary representation of the IR.</p>
<p id="EN-US_TOPIC_0292866532__p104121841986">BC files can be generated in either of the following ways:</p>
<ul id="EN-US_TOPIC_0292866532__ul137511291115"><li id="EN-US_TOPIC_0292866532__li63151448516">Method 1: (Recommended) Use the third-party tool gllvm to generate the BC file.<ul id="EN-US_TOPIC_0292866532__ul93131148416"><li id="EN-US_TOPIC_0292866532__li83131489119">The gllvm tool uses the Go programming language and the Clang compiler. Visit <a href="https://github.com/SRI-CSL/gllvm/blob/master/README.md" target="_blank" rel="noopener noreferrer">https://github.com/SRI-CSL/gllvm/blob/master/README.md</a> to learn about how to use the tool. Version 1.2.9 is recommended.</li><li id="EN-US_TOPIC_0292866532__li143131148015">When using gllvm to build, use the gclang or gclang+ type compiler, and add the compilation option <strong id="EN-US_TOPIC_0292866532__b4515134213588">-g -fno-inline-functions</strong>.</li></ul>
<p id="EN-US_TOPIC_0292866532__p37044121275">Example:</p>
<p id="EN-US_TOPIC_0292866532__p27744391484">Ensure that the current system environment meets the build requirements of the test program.</p>
<ol id="EN-US_TOPIC_0292866532__ol646011106912"><li id="EN-US_TOPIC_0292866532__li17460710792">Configure the Clang compiler and the compiled gllvm tool in the environment variables.<div class="codecoloring" codetype="Bash" id="EN-US_TOPIC_0292866532__screen132494516103"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span>/opt/portadv/tools/weakconsistency/staticcodeanalyzer/llvm-tools/bin:/path/to/gllvm/bin:<span class="nv">$PATH</span>
<span class="nb">export</span> <span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span>/home/porting/lib:<span class="nv">$LD_LIBRARY_PATH</span>
</pre></div>
</td></tr></table></div>
</li><li id="EN-US_TOPIC_0292866532__li1619134421016">Configure gllvm's dependency on Clang.<div class="codecoloring" codetype="Bash" id="EN-US_TOPIC_0292866532__screen1058161415115"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">LLVM_CC_NAME</span><span class="o">=</span><span class="s2">&quot;clang&quot;</span>
<span class="nb">export</span> <span class="nv">LLVM_CXX_NAME</span><span class="o">=</span><span class="s2">&quot;clang++&quot;</span>
<span class="nb">export</span> <span class="nv">LLVM_LINK_NAME</span><span class="o">=</span><span class="s2">&quot;llvm-link&quot;</span>
</pre></div>
</td></tr></table></div>
</li><li id="EN-US_TOPIC_0292866532__li1773585217116">Optimization level: Change all optimization levels of the test project to <strong id="EN-US_TOPIC_0292866532__b12172522437">-O0</strong>.</li><li id="EN-US_TOPIC_0292866532__li6285171219124">Build: Specify gclang as the C compiler, gclang++ as the C++ compiler. Add the compilation option <strong id="EN-US_TOPIC_0292866532__b9255113214516">-g -fno-inline-functions</strong>. This operation varies according to the build tool and parameters of the test project. Other build steps remain unchanged. The following samples are provided for your reference:<ul id="EN-US_TOPIC_0292866532__ul1950785515128"><li id="EN-US_TOPIC_0292866532__li11507185513129">For a project built using scripts without specified input parameters, such as jemalloc, run the following command to specify the compiler type:<div class="fignone" id="EN-US_TOPIC_0292866532__fig20891132164"><span class="figcap"><b>Figure 6 </b>jemalloc</span><br><span><img id="EN-US_TOPIC_0292866532__image2864181447" src="en-us_image_0319959346.png" height="31.979850000000003" width="441.826"></span></div>
</li><li id="EN-US_TOPIC_0292866532__li68351151187">For a project built using scripts with specified input parameters, such as incubator-brpc, run the following command to specify the compiler type based on incubator-brpc's parameter requirements:<div class="fignone" id="EN-US_TOPIC_0292866532__fig122417360185"><span class="figcap"><b>Figure 7 </b>incubator-brpc</span><br><span><img id="EN-US_TOPIC_0292866532__image142710218247" src="en-us_image_0319960694.png" height="14.30681" width="441.826"></span></div>
</li><li id="EN-US_TOPIC_0292866532__li1476413467183">For a project built using the <strong id="EN-US_TOPIC_0292866532__b6528955191118">configure</strong> command, such as sqlite, run the following command to specify the compiler type:<div class="fignone" id="EN-US_TOPIC_0292866532__fig1760614017194"><span class="figcap"><b>Figure 8 </b>sqlite</span><br><span><img id="EN-US_TOPIC_0292866532__image315414537244" src="en-us_image_0319960700.png" height="22.722517999999997" width="441.826"></span></div>
</li><li id="EN-US_TOPIC_0292866532__li1033989131919">If the compiler type is specified in the project configuration file and you need to change the configuration file, use the make build tool to set <strong id="EN-US_TOPIC_0292866532__b82741976166">CC</strong> in the first line of the makefile to <strong id="EN-US_TOPIC_0292866532__b272415345169">glang</strong>, and then run the build command. The following use bwa as an example.<div class="fignone" id="EN-US_TOPIC_0292866532__fig1983363617197"><span class="figcap"><b>Figure 9 </b>Modifying the makefile</span><br><span><img id="EN-US_TOPIC_0292866532__image1864219435254" src="en-us_image_0319960720.png" width="428.526" height="54.060244000000004"></span></div>
<div class="fignone" id="EN-US_TOPIC_0292866532__fig6350104122020"><span class="figcap"><b>Figure 10 </b>bwa</span><br><span><img id="EN-US_TOPIC_0292866532__image930423102617" src="en-us_image_0319960726.png" height="58.06859800000001" width="441.826"></span></div>
</li><li id="EN-US_TOPIC_0292866532__li1059525282010">Generate a BC file: After the build is complete, generate a dynamic library (<strong id="EN-US_TOPIC_0292866532__b1379373612178">.so</strong> file) or an executable file, and use the get-bc tool of gllvm to generate a BC file. The following uses jemalloc as an example.<div class="fignone" id="EN-US_TOPIC_0292866532__fig1094562092119"><span class="figcap"><b>Figure 11 </b>jemalloc</span><br><span><img id="EN-US_TOPIC_0292866532__image631513309267" src="en-us_image_0319960750.png" height="71.533784" width="441.826"></span></div>
</li></ul>
</li></ol>
</li></ul>
<ul id="EN-US_TOPIC_0292866532__ul11700246171416"><li id="EN-US_TOPIC_0292866532__li167008462147">Method 2: Use the project building tool to generate BC files, such as Make and CMake. If the software uses this method, you need to modify the related configuration files, such as the makefile.<ul id="EN-US_TOPIC_0292866532__ul14305050201317"><li id="EN-US_TOPIC_0292866532__li73052050121316">Replacing compilation commands: Use Clang to replace GCC and llvm-link to replace LD.</li><li id="EN-US_TOPIC_0292866532__li1916795616132">Adjusting the compilation options: Modify the optimization level to <strong id="EN-US_TOPIC_0292866532__b873633915469">-O0</strong> and add the compilation option <strong id="EN-US_TOPIC_0292866532__b0865146134611">-flto -g -fno-inline-functions</strong>.</li></ul>
<p id="EN-US_TOPIC_0292866532__p14310164616245">After the preceding operations are complete, build the BC file.</p>
<p id="EN-US_TOPIC_0292866532__p10130845181615">Example:</p>
<div class="notice" id="EN-US_TOPIC_0292866532__note137825512418"><span class="noticetitle"><img src="public_sys-resources/notice_3.0-en-us.png"> </span><div class="noticebody"><ul id="EN-US_TOPIC_0292866532__ul13510135610247"><li id="EN-US_TOPIC_0292866532__li1553104520302">Before building a project, replace the GCC compiler with an LLVM related tool.</li><li id="EN-US_TOPIC_0292866532__li45364510306">During the building, replace or add specified compilation options to prevent the loss of some instruction information that affects the accuracy of analysis results.</li><li id="EN-US_TOPIC_0292866532__li451025602411">Change the generated target file to a BC file.</li></ul>
</div></div>
<ol id="EN-US_TOPIC_0292866532__ol4156175413277"><li id="EN-US_TOPIC_0292866532__li3131710132818">Use the make tool to build a project.<div class="fignone" id="EN-US_TOPIC_0292866532__fig1014201032813"><span class="figcap"><b>Figure 12 </b>Building</span><br><span><img id="EN-US_TOPIC_0292866532__image1514810152811" src="en-us_image_0319918495.png" width="NaN" height="NaN"></span></div>
</li><li id="EN-US_TOPIC_0292866532__li11540204817289">Modify the compile command and replace the compilation options. The original makefile and the modified makefile are as follows:<div class="fignone" id="EN-US_TOPIC_0292866532__fig95401648132812"><span class="figcap"><b>Figure 13 </b>Original makefile</span><br><span><img id="EN-US_TOPIC_0292866532__image030173172914" src="en-us_image_0319961375.png" width="441.826" height="271.380249"></span></div>
<div class="fignone" id="EN-US_TOPIC_0292866532__fig1654044842819"><span class="figcap"><b>Figure 14 </b>Modified makefile</span><br><span><img id="EN-US_TOPIC_0292866532__image106413498294" src="en-us_image_0319961391.png" height="168.314692" width="441.826"></span></div>
<p id="EN-US_TOPIC_0292866532__p554104822813">In the modified makefile file, change the compilation tool to Clang, change the link of the target file generation tool to llvm-link.</p>
</li><li id="EN-US_TOPIC_0292866532__li42451232299">Complete the project building.<div class="fignone" id="EN-US_TOPIC_0292866532__fig824515232299"><span class="figcap"><b>Figure 15 </b>Building completed</span><br><span><img id="EN-US_TOPIC_0292866532__image14228121518309" src="en-us_image_0319961396.png" height="36.187704000000004" width="441.826"></span></div>
</li></ol>
</li></ul>
<div class="note" id="EN-US_TOPIC_0292866532__note1480114622311"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><ul id="EN-US_TOPIC_0292866532__ul859619542517"><li id="EN-US_TOPIC_0292866532__li75966572511">An abnormal BC file may cause inaccurate analysis result.</li><li id="EN-US_TOPIC_0292866532__li859618511251">If the generated BC file is abnormal, it may be caused by compilers such as gfortran involved in the compilation process.</li><li id="EN-US_TOPIC_0292866532__li14596115102513">You can use the LLC of the LLVM and the local GCC to convert the BC file into an executable program and check whether the program functions properly.</li></ul>
</div></div>
</div>
</div>
<div>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a href="en-us_topic_0249523736.html">Enhanced Functions</a></div>
</div>
</div>

<div class="hrcopyright"><hr size="2"></div><div class="hwcopyright">Copyright &copy; Huawei Technologies Co., Ltd.</div></body>
</html>